<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>个人信息</title>
    <meta http-equiv="X-UA-COMPATIBLE" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="stylesheet" href="../../../css/share/base.css"/>
    <link rel="stylesheet" href="../../../css/share/header.css"/>
    <link rel="stylesheet" href="../../../css/share/footer.css"/>
    <link rel="stylesheet" href="../../../css/share/commen.css"/>
    <link rel="stylesheet" href="../../../css/my/pers_infor.css"/>
    <link rel="stylesheet" href="../../../plug/touxiang/css/style.css"/>
</head>
<body>
<div id="img_mask" class="mymask">
    <div id="toucontDiv">
        <div class="container">
            <div class="imageBox">
                <div class="thumbBox"></div>
                <div class="spinner" style="display: none">Loading...</div>
            </div>
            <div class="action">
                <div class="new-contentarea tc">
                    <a href="javascript:void(0)" class="upload-img">
                        <label for="upload-file">选择图片</label>
                    </a>
                    <input type="file" class="" name="upload-file" id="upload-file" />
                </div>
                <input type="button" id="btnCrop"  class="Btnsty_peyton" value="裁切">
                <input type="button" id="btnZoomIn" class="Btnsty_peyton" value="+"  >
                <input type="button" id="btnZoomOut" class="Btnsty_peyton" value="-" >
            </div>
            <div class="cropped">
                <div id="imgtext">图片预览区</div>
                <div id="imgDiv"></div>
                <div id="imgbtn">确认上传</div>
                <div id="imgbtn_quit">取消上传</div>
            </div>
        </div>
    </div>
</div>
<header>
    <nav>
        <div class="nav_div1">
            <div class="logo_imgbox"><img src="../../../images/index/ic_home_logo.png" alt=""/></div>
            <ul class="left_ul">
                <a href="../index.html"><li>首页</li></a>
                <a href="../job/apply_job.html"><li>求职</li></a>
                <a href="../news/newsList.html"><li>新闻</li></a>
                <a href="../enterprise.html"><li>企业版</li></a>
            </ul>
        </div>
        <ul class="nav_div2">
            <a href="../message/message.html"><li class="xx">消息 </li></a>
            <a href="../resume/resume.html"><li>我的简历</li></a>
            <a href="../delivery_box/delivery_success.html"><li>投递箱</li></a>
            <a href="#" id="header_last" class="activ">
            	<li><span id="head_logbtn">登录</span>&nbsp;/&nbsp;
            	<span id="head_regbtn">注册</span></li>
            </a> 
        </ul>
    </nav>
</header>
<section class="my_body">
    <div class="my_left">
        <div id="pers" class="my_left_div my_left_active"><span class="myfont">&#xe612;</span><span>个人信息</span></div>
        <div id="acco" class="my_left_div"><span class="myfont">&#xe622;</span><span>账号绑定</span></div>
        <div id="chan" class="my_left_div"><span class="myfont">&#xe660;</span><span>修改密码</span></div>
    </div>
    <div class="my_right">
        <div class="my_rightmain my_rightmain1">
            <div class="my_rightmian_div1">
                <div class="my_rightmian_div1left">
                    <div class="my_touxiang"><img id="my_headimg" src="" alt=""/></div>
                    <div class="my_xinxibox">
                        <div class="my_namebox"><span id="uname1"> </span><span class="my_zhiye"> </span></div>
                        <div class="my_sexbox"><span id="usex1"> </span><span id="udegree1"> </span></div>
                    </div>
                </div>
                <div class="my_edit"><span class="myfont my_editfont">&#xe635;</span></div>
            </div>
            <div class="my_rightmian_div2">
                <p id="uselfIntro1"> </p>
            </div>
            <div class="my_rightmian_div3">
                (*此信息用于站内的沟通、社区等功能，不会同步修改简历)
            </div>
        </div>
        <div class="my_rightmain my_rightmain2">
            <div class="my_touxiang myedit_touxiang">
                <img id="my_headImg2" src="" alt=""/>
                <span class="myfont myfont_xj">&#xe634;</span>
            </div>
            <div class="myedit_namebox">
                <div class="myedit_namebox_div1">
                    <div class="myedit_label">姓名</div>
                    <div class="myedit_input"><input id="uname" type="text"/></div>
                </div>
                <div class="myedit_namebox_div2 ">
                    <div class="myedit_label">性别</div>
                    <div class="myedit_sexbox">
                        <span id="myedit_nan">男</span>
                        <span id="myedit_nv" class="mysex">女</span>
                    </div>
                </div>
            </div>
            <div class="myedit_zhiyebox">
                <div class="myedit_label">职业</div>
                <div class="myedit_input"><input id="ujob" type="text"/></div>
            </div>
            <div class="myedit_zhiyebox">
                <div class="myedit_label">学历</div>
                <div class="myedit_input"><input id="udegree" type="text"/></div>
            </div>
            <div class="myedit_zhiyebox">
                <div class="myedit_label">个人介绍</div>
                <div class="myedit_input">
                    <textarea name="" id="work_content" cols="30" rows="10"  maxlength="1000"
                              onkeyup="javascript:setShowLength(this, 1000, 'cost_tpl_title_length');"></textarea>
                    <div class="texterea_tips"><span class="red" id="cost_tpl_title_length">0</span>/1000字</div>
                </div>
            </div>
            <div class="myedit_btnbox">
                <span class="myedit_savebtn">保存</span>
                <span class="myedit_quitbtn">取消</span>
            </div>
        </div>
    </div>
</section>
<footer>
    <div class="footer_mainBox">
        <div class="footer_div1">
            <div class="footer_left">
                <ul>
                    <a href="../our/about_us.html"><li>关于我们</li></a>
                    <a href="../our/join_us.html"><li class="footer_li_2">加入我们</li></a>
                    <a href="../our/contact_us.html"><li>联系我们</li></a>
                </ul>
                <div>服务热线：028-65231120</div>
            </div>
            <div class="footer_right">
                <!--微博-->
                <div><span class="myfont footer_sinafont">&#xe650;</span></div>
                <!--微信-->
                <div class="footer_wxbox"><span class="myfont footer_wxfont">&#xe607;</span></div>
            </div>
        </div>
        <div class="footer_bei">Copyright c 2017 zhipin.com 北京华品博睿网络有限公司 京ICP备14013441号-5</div>
    </div>
</footer>
</body>
<script src="../../../js/jquery-1.11.3.js"></script>
<script src="../../../js/ip.js"></script>
<script src="../../../plug/layer/layer.js"></script>
<script src="../../../js/my/pers_infor.js"></script>
<script src="../../../js/my/my.js"></script>
<script src="../../../plug/touxiang/js/cropbox.js"></script>
<script>
	$(function() { 
		myonload2("pers_infor.html","../../Enterprise_edition/talent_recom.html","../index.html");
		var userIdValue = getCookieValue("userId"); 
		console.log(userIdValue)
		if(userIdValue==""){//未登录，请先登录
		    window.location.href="../login.html";
		}else{
		    $.get(ip+"/rrp/user/findUserInfo.do",{userId:userIdValue},function(data){
		    	if(data.state==0){
		    		console.log(data.data);
		    		$("#my_headimg").attr("src",data.data.headImg)
		    		$("#uname1").html(data.data.nickname)
		    		$(".my_zhiye").html(data.data.job)
		    		$("#usex1").html(data.data.sex)
		    		$("#udegree1").html(data.data.degree)
		    		$("#uselfIntro1").html(data.data.selfIntro)
		    		//头像处理
					var options =
			        {
			            thumbBox: '.thumbBox',
			            spinner: '.spinner',
			            imgSrc: data.data.headImg//TO-DO
			        };
			        var cropper = $('.imageBox').cropbox(options);
			        $('#upload-file').on('change', function(){
			            var reader = new FileReader();
			            reader.onload = function(e) {
			                options.imgSrc = e.target.result;
			                cropper = $('.imageBox').cropbox(options);
			            }
			            reader.readAsDataURL(this.files[0]);
			            this.files = [];
			        })
			        var imgMain
			        $('#btnCrop').on('click', function(){
			            imgMain= cropper.getDataURL();
			
			            $('#imgDiv').html('');
			            $('#imgDiv').append('<img src="'+imgMain+'" align="absmiddle" style="width:100px;margin-top:30px;border-radius:50%;box-shadow:0px 0px 12px #7E7E7E;" ><p>100px*100px</p>');
			        })
			        $('#btnZoomIn').on('click', function(){
			            cropper.zoomIn();
			        })
			        $('#btnZoomOut').on('click', function(){
			            cropper.zoomOut();
			        })
			        $("#imgbtn").click(function(){
			            if(imgMain==undefined){
			                layer.msg("没有剪切图片")
			            }else{
			                //console.log(imgMain)
			                $.post(ip+"/rrp/user/modifyHeadImg.do",{userId:userIdValue,base64:imgMain},function(data){
			                	console.log(data)
			                })
			            }
			        })
			        $("#imgbtn_quit").click(function(){
			            $("#img_mask").css("display","none")
			        })
			        
		    	}else{
		    		layer.msg(data.message)
		    	}
		    },'json')	
		}
		
		
		
	});
	
	$(".myedit_savebtn").click(function () {
		var uid = getCookieValue("userId");
		var uname=$("#uname").val();
		var usex=$(".mysex").html();
		var ujob=$("#ujob").val();
		var udegree=$("#udegree").val();
		var uselfIntro=$("#work_content").val();
		console.log(uid,uname,usex,ujob,udegree,uselfIntro);
		$.ajax({
            type: "post",
            url: ip+"/rrp/user/modifyUserInfo.do",
            data: {userId:uid,nickname:uname,sex:usex,job:ujob,degree:udegree,selfIntro:uselfIntro},
            dataType: "json",
            success: function(data){
          	    console.log(data);
                if(data.state==0){
                	window.location.href="pers_infor.html";
                }else{
                	layer.msg(data.message)
                }
            }
        });
	})
	$(".myedit_touxiang").click(function(){
        $("#img_mask").css("display","block")
    })
	$(".myedit_quitbtn").click(function () {
		$(".my_rightmain1").css("display","block");
	    $(".my_rightmain2").css("display","none")
	})
	
</script>
</html>